import u,{createContext as ae,createRef as se,useContext as V,useEffect as F,useMemo as h,useReducer as pe,useRef as I,useState as de}from"react";import{match as k}from"../../utils/match.js";import{forwardRefWithAs as A,render as E,Features as K}from"../../utils/render.js";import{useSyncRefs as b}from"../../hooks/use-sync-refs.js";import{Keys as ue}from"../keyboard.js";import{isDisabledReactIssue7711 as fe}from"../../utils/bugs.js";import{useId as C}from"../../hooks/use-id.js";import{FocusTrap as O}from"../../components/focus-trap/focus-trap.js";import{useInertOthers as ge}from"../../hooks/use-inert-others.js";import{Portal as x}from"../../components/portal/portal.js";import{ForcePortalRoot as H}from"../../internal/portal-force-root.js";import{Description as ce,useDescriptions as Te}from"../description/description.js";import{useOpenClosed as me,State as q}from"../../internal/open-closed.js";import{useServerHandoffComplete as De}from"../../hooks/use-server-handoff-complete.js";import{StackProvider as Pe,StackMessage as z}from"../../internal/stack-context.js";import{useOutsideClick as ye}from"../../hooks/use-outside-click.js";import{getOwnerDocument as Re}from"../../utils/owner.js";import{useOwnerDocument as he}from"../../hooks/use-owner.js";import{useEventListener as ve}from"../../hooks/use-event-listener.js";import{Hidden as Ae,Features as Ee}from"../../internal/hidden.js";import{useEvent as S}from"../../hooks/use-event.js";var be=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(be||{}),Ce=(e=>(e[e.SetTitleId=0]="SetTitleId",e))(Ce||{});let Oe={[0](i,e){return i.titleId===e.id?i:{...i,titleId:e.id}}},M=ae(null);M.displayName="DialogContext";function L(i){let e=V(M);if(e===null){let t=new Error(`<${i} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,L),t}return e}function Se(i,e){return k(e.type,Oe,i,e)}let Le="div",we=K.RenderStrategy|K.Static,Fe=A(function(e,t){let{open:o,onClose:n,initialFocus:d,__demoMode:g=!1,...c}=e,[m,D]=de(0),v=me();o===void 0&&v!==null&&(o=k(v,{[q.Open]:!0,[q.Closed]:!1}));let a=I(new Set),f=I(null),J=b(f,t),W=I(null),P=he(f),B=e.hasOwnProperty("open")||v!==null,G=e.hasOwnProperty("onClose");if(!B&&!G)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!B)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!G)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(typeof o!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${o}`);if(typeof n!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${n}`);let s=o?0:1,[y,Q]=pe(Se,{titleId:null,descriptionId:null,panelRef:se()}),R=S(()=>n(!1)),U=S(r=>Q({type:0,id:r})),_=De()?g?!1:s===0:!1,w=m>1,$=V(M)!==null,X=w?"parent":"leaf";ge(f,w?_:!1),ye(()=>{var l,p;return[...Array.from((l=P==null?void 0:P.querySelectorAll("body > *, [data-headlessui-portal]"))!=null?l:[]).filter(T=>!(!(T instanceof HTMLElement)||T.contains(W.current)||y.panelRef.current&&T.contains(y.panelRef.current))),(p=y.panelRef.current)!=null?p:f.current]},R,_&&!w),ve(P==null?void 0:P.defaultView,"keydown",r=>{r.defaultPrevented||r.key===ue.Escape&&s===0&&(w||(r.preventDefault(),r.stopPropagation(),R()))}),F(()=>{var j;if(s!==0||$)return;let r=Re(f);if(!r)return;let l=r.documentElement,p=(j=r.defaultView)!=null?j:window,T=l.style.overflow,le=l.style.paddingRight,Y=p.innerWidth-l.clientWidth;if(l.style.overflow="hidden",Y>0){let ne=l.clientWidth-l.offsetWidth,ie=Y-ne;l.style.paddingRight=`${ie}px`}return()=>{l.style.overflow=T,l.style.paddingRight=le}},[s,$]),F(()=>{if(s!==0||!f.current)return;let r=new IntersectionObserver(l=>{for(let p of l)p.boundingClientRect.x===0&&p.boundingClientRect.y===0&&p.boundingClientRect.width===0&&p.boundingClientRect.height===0&&R()});return r.observe(f.current),()=>r.disconnect()},[s,f,R]);let[Z,ee]=Te(),te=`headlessui-dialog-${C()}`,oe=h(()=>[{dialogState:s,close:R,setTitleId:U},y],[s,y,R,U]),N=h(()=>({open:s===0}),[s]),re={ref:J,id:te,role:"dialog","aria-modal":s===0?!0:void 0,"aria-labelledby":y.titleId,"aria-describedby":Z};return u.createElement(Pe,{type:"Dialog",element:f,onUpdate:S((r,l,p)=>{l==="Dialog"&&k(r,{[z.Add](){a.current.add(p),D(T=>T+1)},[z.Remove](){a.current.add(p),D(T=>T-1)}})})},u.createElement(H,{force:!0},u.createElement(x,null,u.createElement(M.Provider,{value:oe},u.createElement(x.Group,{target:f},u.createElement(H,{force:!1},u.createElement(ee,{slot:N,name:"Dialog.Description"},u.createElement(O,{initialFocus:d,containers:a,features:_?k(X,{parent:O.features.RestoreFocus,leaf:O.features.All&~O.features.FocusLock}):O.features.None},E({ourProps:re,theirProps:c,slot:N,defaultTag:Le,features:we,visible:s===0,name:"Dialog"})))))))),u.createElement(Ae,{features:Ee.Hidden,ref:W}))}),ke="div",Me=A(function(e,t){let[{dialogState:o,close:n}]=L("Dialog.Overlay"),d=b(t),g=`headlessui-dialog-overlay-${C()}`,c=S(a=>{if(a.target===a.currentTarget){if(fe(a.currentTarget))return a.preventDefault();a.preventDefault(),a.stopPropagation(),n()}}),m=h(()=>({open:o===0}),[o]);return E({ourProps:{ref:d,id:g,"aria-hidden":!0,onClick:c},theirProps:e,slot:m,defaultTag:ke,name:"Dialog.Overlay"})}),_e="div",Ie=A(function(e,t){let[{dialogState:o},n]=L("Dialog.Backdrop"),d=b(t),g=`headlessui-dialog-backdrop-${C()}`;F(()=>{if(n.panelRef.current===null)throw new Error("A <Dialog.Backdrop /> component is being used, but a <Dialog.Panel /> component is missing.")},[n.panelRef]);let c=h(()=>({open:o===0}),[o]);return u.createElement(H,{force:!0},u.createElement(x,null,E({ourProps:{ref:d,id:g,"aria-hidden":!0},theirProps:e,slot:c,defaultTag:_e,name:"Dialog.Backdrop"})))}),xe="div",He=A(function(e,t){let[{dialogState:o},n]=L("Dialog.Panel"),d=b(t,n.panelRef),g=`headlessui-dialog-panel-${C()}`,c=h(()=>({open:o===0}),[o]),m=S(a=>{a.stopPropagation()});return E({ourProps:{ref:d,id:g,onClick:m},theirProps:e,slot:c,defaultTag:xe,name:"Dialog.Panel"})}),We="h2",Be=A(function(e,t){let[{dialogState:o,setTitleId:n}]=L("Dialog.Title"),d=`headlessui-dialog-title-${C()}`,g=b(t);F(()=>(n(d),()=>n(null)),[d,n]);let c=h(()=>({open:o===0}),[o]);return E({ourProps:{ref:g,id:d},theirProps:e,slot:c,defaultTag:We,name:"Dialog.Title"})}),mt=Object.assign(Fe,{Backdrop:Ie,Panel:He,Overlay:Me,Title:Be,Description:ce});export{mt as Dialog};
